FROM codercom/enterprise-base:ubuntu

# Save NVM version and node version as build args
USER coder

ARG NVM_VERSION=v0.39.7
ARG NODE_VERSION=20.11.0

# Add script progress echo markers
RUN echo "üöÄ Starting development environment setup..."

# # Install essential build tools and curl
# RUN echo "üì¶ Installing basic dependencies..." && \
#     apt-get update && \
#     DEBIAN_FRONTEND=noninteractive apt-get install -y \
#     curl \
#     git \
#     build-essential \
#     ca-certificates \
#     && echo "‚úÖ Basic dependencies installed"

RUN echo "üì• Installing NVM ${NVM_VERSION}..." && \
    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/${NVM_VERSION}/install.sh | bash && \
    echo "‚úÖ NVM installation script completed"

# Add NVM to bash profile and environment
RUN echo "üîß Configuring NVM environment..." && \
    echo 'export NVM_DIR="$HOME/.nvm"' >> ~/.bashrc && \
    echo '[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"' >> ~/.bashrc && \
    echo '[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"' >> ~/.bashrc && \
    echo "‚úÖ NVM environment configured"

# Install Node.js using NVM (this runs in a new shell to access NVM)
RUN echo "üì• Installing Node.js ${NODE_VERSION}..." && \
    bash -c 'source $HOME/.nvm/nvm.sh && \
    nvm install ${NODE_VERSION} && \
    nvm alias default ${NODE_VERSION} && \
    nvm use default' && \
    echo "‚úÖ Node.js installation completed"

RUN echo "üîç Verifying installations..." && \
    bash -c 'source $HOME/.nvm/nvm.sh && \
    echo "NVM Version: $(nvm --version)" && \
    echo "Node Version: $(node --version)" && \
    echo "NPM Version: $(npm --version)"' && \
    echo "‚úÖ All verifications completed"

WORKDIR /workspaces

RUN echo "üéâ Development environment setup completed successfully!"
# USER coder

CMD ["/bin/bash"]